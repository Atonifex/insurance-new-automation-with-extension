"use strict";(()=>{var a={currentCaseId:null,currentCase:null,autofillState:"idle",currentHost:null,detectedCarrier:null,lastError:null,currentPageIdentifier:null};chrome.runtime.onMessage.addListener((e,t,r)=>{var i,n,c,l;switch(console.log("[Background] Received message:",e.type,"from:",(i=t.tab)==null?void 0:i.url),e.type){case"MFA_DETECTED":a.autofillState="paused",a.lastError="MFA verification required",(n=t.tab)!=null&&n.id&&(chrome.action.setBadgeText({text:"MFA",tabId:t.tab.id}),chrome.action.setBadgeBackgroundColor({color:"#D97706",tabId:t.tab.id})),r({received:!0});break;case"PAGE_COMPLETED":let s=e.payload;a.currentPageIdentifier=s.pageId,a.lastError=null,r({received:!0});break;case"AUTOFILL_ERROR":let d=e.payload;a.autofillState="error",a.lastError=d.message,(c=t.tab)!=null&&c.id&&(chrome.action.setBadgeText({text:"!",tabId:t.tab.id}),chrome.action.setBadgeBackgroundColor({color:"#DC2626",tabId:t.tab.id})),r({received:!0});break;case"AUTOFILL_COMPLETE":a.autofillState="completed",a.lastError=null,(l=t.tab)!=null&&l.id&&(chrome.action.setBadgeText({text:"\u2713",tabId:t.tab.id}),chrome.action.setBadgeBackgroundColor({color:"#059669",tabId:t.tab.id})),r({received:!0});break;case"GET_STATE":r({state:a});break;case"API_REQUEST":return u(e.payload).then(o=>r(o)).catch(o=>r({error:o.message})),!0;default:r({error:"Unknown message type"})}return!0});async function u(e){try{let t=await fetch(e.url,{...e.options,credentials:"include"}),r=await t.json();return t.ok?{data:r}:{error:r.error||`HTTP ${t.status}`}}catch(t){return{error:t instanceof Error?t.message:"Network error"}}}chrome.tabs.onRemoved.addListener(e=>{chrome.action.setBadgeText({text:"",tabId:e})});chrome.tabs.onUpdated.addListener((e,t)=>{t.status==="loading"&&chrome.action.setBadgeText({text:"",tabId:e})});chrome.runtime.onInstalled.addListener(e=>{e.reason==="install"?console.log("[Background] Extension installed"):e.reason==="update"&&console.log("[Background] Extension updated to version:",chrome.runtime.getManifest().version)});console.log("[Background] Service worker initialized");})();
